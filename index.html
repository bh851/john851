<!doctype html>
<html lang="sw">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title> Nzuga Calculator</title>
  <style>
    :root{
      --bg: linear-gradient(135deg,#111827 0%, #0f172a 100%);
      --card: linear-gradient(180deg,#0b1220 0%, #0f172a 100%);
      --accent: #7c3aed;
      --accent-2: #06b6d4;
      --glass: rgba(255,255,255,0.04);
      --muted: rgba(255,255,255,0.65);
      --danger: #ef4444;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background:var#fefefe;;
      color:#e6eef8;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:32px;
    }

    .wrap{
      width:360px;
      max-width:95vw;
      border-radius:18px;
      background:var(--card);
      box-shadow: 0 10px 30px rgba(2,6,23,0.7), inset 0 1px 0 rgba(255,255,255,0.02);
      padding:18px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .title{
      font-size:16px;
      font-weight:600;
      letter-spacing:0.2px;
    }
    .sub{
      font-size:12px;
      color:var(--muted);
    }

    .screen{
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:6px;
      min-height:86px;
    }

    .expression{
      font-size:14px;
      color:var(--muted);
      word-break:break-all;
      min-height:18px;
    }

    .result{
      font-size:28px;
      font-weight:700;
      text-align:right;
      letter-spacing:0.6px;
      word-break:break-all;
    }

    .pad{
      display:grid;
      grid-template-columns: repeat(4,1fr);
      gap:10px;
      margin-top:4px;
    }

    button.btn{
      border:0;
      padding:14px 12px;
      border-radius:10px;
      font-size:18px;
      font-weight:600;
      cursor:pointer;
      background:var(--glass);
      color:inherit;
      box-shadow: 0 4px 10px rgba(2,6,23,0.5);
      transition:transform .06s ease, box-shadow .08s ease, background .12s ease;
      user-select:none;
    }
    button.btn:active{ transform: translateY(1px) scale(.998); }

    button.op{ color:#fff; background: linear-gradient(90deg,var(--accent), var(--accent-2)); }
    button.fn{ background: rgba(255,255,255,0.03); color:var(--muted); font-weight:700; }
    button.equal{ grid-column: span 2; background: linear-gradient(90deg,#10b981, #06b6d4); color:white; font-size:20px; }
    button.clear{ background: rgba(239,68,68,0.12); color:var(--danger); font-weight:700; }

    .small{
      font-size:13px;
      opacity:.9;
      color:var(--muted);
    }

    /* responsive tweaks */
    @media (max-width:420px){
      .wrap{ padding:12px }
      button.btn{ padding:12px; font-size:16px }
      .result{ font-size:24px }
    }
  </style>
</head>
<body>
  <div class="wrap" role="application" aria-label="Calculator">
    <div class="header">
      <div>
        <div class="title">NzugaCalculate</div>
        
      </div>
      <div class="small">Press <kbd>Enter</kbd> to evaluate</div>
    </div>

    <div class="screen" id="screen">
      <div id="expression" class="expression" aria-live="polite"></div>
      <div id="result" class="result" aria-live="polite">0</div>
    </div>

    <div class="pad" id="pad">
      <button class="btn fn clear" data-action="clear">AC</button>
      <button class="btn fn" data-action="toggle-sign">±</button>
      <button class="btn fn" data-action="percent">%</button>
      <button class="btn op" data-value="/">÷</button>

      <button class="btn" data-value="7">7</button>
      <button class="btn" data-value="8">8</button>
      <button class="btn" data-value="9">9</button>
      <button class="btn op" data-value="*">×</button>

      <button class="btn" data-value="4">4</button>
      <button class="btn" data-value="5">5</button>
      <button class="btn" data-value="6">6</button>
      <button class="btn op" data-value="-">−</button>

      <button class="btn" data-value="1">1</button>
      <button class="btn" data-value="2">2</button>
      <button class="btn" data-value="3">3</button>
      <button class="btn op" data-value="+">+</button>

      <button class="btn" data-value="0" style="grid-column: span 2;">0</button>
      <button class="btn" data-value=".">.</button>
      <button class="btn equal" data-action="evaluate">=</button>
    </div>
  </div>

  <script>
    (function(){
      const expressionEl = document.getElementById('expression');
      const resultEl = document.getElementById('result');
      const pad = document.getElementById('pad');

      let expr = '';      // user-visible expression (with × ÷ symbols for display)
      let safeExpr = '';  // machine expression using standard operators (* /)

      const display = () => {
        expressionEl.textContent = expr || '';
        resultEl.textContent = safeExpr === '' ? '0' : safeEvaluatePreview(safeExpr);
      };

      // Create a short-preview of evaluation or the expression itself.
      function safeEvaluatePreview(code) {
        // try to evaluate, but catch errors and show raw code as fallback
        try {
          // don't evaluate if ends with operator:
          if (/[+\-*/.]$/.test(code)) return code;
          const val = evaluateExpression(code);
          if (Number.isFinite(val)) {
            return trimNumber(val);
          }
          return 'Error';
        } catch(e){
          return code;
        }
      }

      function trimNumber(n){
        // show integer as-is; otherwise limit to 10 significant digits
        if (Number.isInteger(n)) return String(n);
        return parseFloat(n.toPrecision(10)).toString();
      }

      // sanitize and then evaluate using Function (safe-ish after validation)
      function evaluateExpression(code) {
        // allow digits, whitespace, + - * / ( ) and dot
        if (!/^[0-9+\-*/().\s]+$/.test(code)) throw new Error('Invalid characters');
        // avoid sequences that could be dangerous (like "2constructor")
        if (/constructor|prototype|=>/.test(code)) throw new Error('Unsafe');
        // eval via Function
        // eslint-disable-next-line no-new-func
        const fn = new Function('return (' + code + ')');
        return fn();
      }

      // Helpers to update both display strings when user presses buttons
      function appendChar(ch){
        // ch is a character used in safeExpr (i.e., digits or operators like + - * / . ( ) )
        safeExpr += ch;
        // For visual expression, display × and ÷ symbols for * and /
        if (ch === '*') expr += '×';
        else if (ch === '/') expr += '÷';
        else expr += ch;
        display();
      }

      function backspace(){
        if (!safeExpr) return;
        // remove last char from safeExpr, and last display char from expr
        safeExpr = safeExpr.slice(0, -1);
        expr = expr.slice(0, -1);
        display();
      }

      function clearAll(){
        expr = '';
        safeExpr = '';
        display();
      }

      function toggleSign(){
        // tries to toggle sign of the last number in the expression
        // find last number token
        const m = safeExpr.match(/([+\-*/()]|^)([0-9.]+)$/);
        if (!m) return;
        const prefix = safeExpr.slice(0, m.index + (m[1] ? 1 : 0));
        const number = m[2];
        // remove the number and replace with ( -number )
        const newNumber = '(-' + number + ')';
        safeExpr = prefix + newNumber;
        // rebuild expr display (replace * and /)
        expr = safeExpr.replace(/\*/g, '×').replace(/\//g, '÷');
        display();
      }

      function percent(){
        // convert last number to percentage (divide by 100)
        const m = safeExpr.match(/([+\-*/()]|^)([0-9.]+)$/);
        if (!m) return;
        const prefix = safeExpr.slice(0, m.index + (m[1] ? 1 : 0));
        const number = parseFloat(m[2]);
        const newNumber = String(number / 100);
        safeExpr = prefix + newNumber;
        expr = safeExpr.replace(/\*/g, '×').replace(/\//g, '÷');
        display();
      }

      function evaluateNow(){
        try {
          // Guard: remove trailing operator(s)
          let code = safeExpr.replace(/[+\-*/. ]+$/,'');
          if (!code) return;
          const val = evaluateExpression(code);
          if (!Number.isFinite(val)) {
            resultEl.textContent = 'Error';
            return;
          }
          // show full result and set expression to that result for chaining
          const s = trimNumber(val);
          expr = s;
          safeExpr = String(val);
          display();
        } catch (err){
          resultEl.textContent = 'Error';
        }
      }

      // Click handlers
      pad.addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if (!btn) return;
        const v = btn.getAttribute('data-value');
        const action = btn.getAttribute('data-action');

        if (action === 'clear') { clearAll(); return; }
        if (action === 'toggle-sign') { toggleSign(); return; }
        if (action === 'percent') { percent(); return; }
        if (action === 'evaluate') { evaluateNow(); return; }

        if (v) {
          // If previous result displayed and safeExpr is a number (result), and user presses digit -> start new
          if (/^[0-9.]+$/.test(v) && /^[0-9.\-()]+$/.test(safeExpr) && expressionEl.textContent === safeExpr) {
            // If expr currently is a plain number (from previous result) and user presses a digit, replace.
            if (/^\-?\d+(\.\d+)?$/.test(safeExpr)) {
              clearAll();
            }
          }
          // Prevent multiple operators in a row (except minus for negative)
          const last = safeExpr.slice(-1);
          if (['+','-','*','/'].includes(v)) {
            if (!safeExpr) {
              // if starting with operator + or * or /, ignore except minus
              if (v === '-') appendChar(v);
              return;
            }
            if (['+','-','*','/'].includes(last)) {
              // replace last operator with new one
              safeExpr = safeExpr.slice(0,-1) + v;
              expr = expr.slice(0,-1) + (v === '*' ? '×' : v === '/' ? '÷' : v);
              display();
              return;
            }
          }

          appendChar(v);
        }
      });

      // Keyboard support
      window.addEventListener('keydown', (e) => {
        const k = e.key;
        if ((k >= '0' && k <= '9') || k === '.' ) {
          appendChar(k);
          e.preventDefault();
          return;
        }
        if (k === 'Enter' || k === '=') { evaluateNow(); e.preventDefault(); return; }
        if (k === 'Backspace') { backspace(); e.preventDefault(); return; }
        if (k === 'Escape') { clearAll(); e.preventDefault(); return; }

        // map x and × to *
        if (k === '*' || k === 'x' || k === 'X') { appendChar('*'); e.preventDefault(); return; }
        if (k === '/') { appendChar('/'); e.preventDefault(); return; }

        if (k === '+' || k === '-' ) { appendChar(k); e.preventDefault(); return; }
        if (k === '(' || k === ')') { appendChar(k); e.preventDefault(); return; }

        // percent shortcut: Shift+5 or '%'
        if (k === '%') { percent(); e.preventDefault(); return; }
      });

      // initialize
      clearAll();
    })();
  </script>
</body>
</html>
